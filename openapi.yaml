openapi: 3.0.0
info:
  title: API Red Social - Portafolio
  description: >
    API Backend construida con Node.js, Express y MySQL.

    Permite a los usuarios registrarse, iniciar sesi贸n (JWT), gestionar posts, dar like a post, comentar y seguir a otros usuarios.

    1. Para probar endpoints protegidos con  (JWT), usa el Login primero (name: user123. password: ). 
    2. Para crear usuarios (POST /user), se requiere una API Key (simulada o provista en README).
  version: 1.0.0
  contact:
    name: Zennon
    url: https://github.com/ZennonGihub/ApiRedSocial

servers:
  - url: http://localhost:3000/api/v1
    description: Servidor Local (Desarrollo)
  - url: https://api-red-social-five.vercel.app/api/v1
    description: Servidor Producci贸n (Vercel)

# COMPONENTES
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

    apiKeyAuth:
      type: apiKey
      in: header
      name: api_key

  schemas:
    # MODELOS DE AUTH
    LoginInput:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          example: "tito_dev"
        password:
          type: string
          format: password
          example: "secreto123"

    AuthResponse:
      type: object
      properties:
        error:
          type: boolean
          example: false
        status:
          type: integer
          example: 201
        body:
          type: string
          description: Token JWT
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    # MODELOS DE USER
    User:
      type: object
      properties:
        id:
          type: string
          example: "user-uuid-1234"
        username:
          type: string
          example: "tito_dev"
        name:
          type: string
          example: "Tito Developer"

    UserInput:
      type: object
      required:
        - username
        - password
        - name
      properties:
        name:
          type: string
          example: "Nuevo Usuario"
        username:
          type: string
          example: "nuevo_user"
        password:
          type: string
          format: password
          example: "123456"

    # MODELOS DE POST
    Post:
      type: object
      properties:
        id:
          type: integer
          example: 10
        text:
          type: string
          example: "Este es un nuevo post en mi muro!"
        user_id:
          type: string
          example: "user-555"
        image:
          type: string
          description: URL de la imagen (opcional)
          example: "https://mi-bucket.com/foto.jpg"

    PostInput:
      type: object
      required:
        - text
      properties:
        text:
          type: string
          description: Contenido del post
          example: "Programando mi API con Node.js"
        image:
          type: string
          description: URL de una imagen opcional
          example: "https://mi-imagen.com/perfil.png"

    # MODELOS DE COMMENTS
    Comment:
      type: object
      properties:
        id:
          type: integer
          example: 15
        contenido:
          type: string
          example: "Excelente post, muy 煤til!"
        post_id:
          type: integer
          example: 3
        user_id:
          type: string
          example: "user-123"
        fecha:
          type: string
          format: date-time
          example: "2023-11-20T10:00:00Z"

    CommentInput:
      type: object
      required:
        - contenido
      properties:
        contenido:
          type: string
          description: El texto del comentario
          example: "Me ha gustado mucho este contenido."

# RUTAS
paths:
  # AUTH
  /auth/login:
    post:
      tags:
        - Auth
      summary: Iniciar Sesi贸n
      description: Devuelve un Token JWT si las credenciales son correctas.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginInput"
      responses:
        201:
          description: Login exitoso
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        401:
          description: Credenciales inv谩lidas

  # USER
  /user:
    get:
      tags:
        - User
      summary: Listar todos los usuarios
      description: Obtiene lista de usuarios. P煤blico (sin Auth).
      responses:
        200:
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"

    post:
      tags:
        - User
      summary: Registrar nuevo usuario
      description: Crea un usuario. Requiere API Key para evitar spam.
      security:
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserInput"
      responses:
        201:
          description: Usuario creado exitosamente
        500:
          description: Error al crear usuario

  /user/{id}:
    get:
      tags:
        - User
      summary: Obtener usuario por ID
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        200:
          description: Datos del usuario
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"

    patch:
      tags:
        - User
      summary: Actualizar usuario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserInput"
      responses:
        200:
          description: Usuario actualizado

    delete:
      tags:
        - User
      summary: Eliminar usuario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        200:
          description: Usuario eliminado

  /user/follow/{id}:
    post:
      tags:
        - User
      summary: Seguir a un usuario
      description: El usuario logueado sigue al usuario del ID especificado.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
          description: ID del usuario a seguir
      responses:
        201:
          description: Follow exitoso

  /user/{id}/following:
    get:
      tags:
        - User
      summary: Ver a qui茅n sigue un usuario
      parameters:
        - in: path
          name: id
          schema: { type: string }
          required: true
      responses:
        201:
          description: Lista de seguidos

  # POSTS
  /post:
    get:
      tags:
        - Post
      summary: Listar todos los posts
      description: Obtiene la lista completa de publicaciones. Requiere Token.
      security:
        - bearerAuth: []
      responses:
        200:
          description: Lista de posts obtenida
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Post"
        401:
          description: No autorizado (Falta Token)

  /post/crear:
    post:
      tags:
        - Post
      summary: Crear un nuevo post
      description: Crea una publicaci贸n asociada al usuario del Token.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostInput"
      responses:
        201:
          description: Post creado exitosamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Post"

  /post/{id}:
    get:
      tags:
        - Post
      summary: Obtener un post por ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
          description: ID del post a buscar
      responses:
        200:
          description: Detalle del post
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Post"
        404:
          description: Post no encontrado

    patch:
      tags:
        - Post
      summary: Actualizar un post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostInput"
      responses:
        200:
          description: Post actualizado correctamente

    delete:
      tags:
        - Post
      summary: Eliminar un post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        201:
          description: Post eliminado correctamente

  /post/{id}/like:
    post:
      tags:
        - Post
      summary: Dar Like a un post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
          description: ID del post al que dar like
      responses:
        201:
          description: Like registrado exitosamente

  # COMMENTS
  /comments:
    get:
      tags:
        - Comments
      summary: Listar todos los comentarios
      security:
        - bearerAuth: []
      responses:
        200:
          description: Lista de comentarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Comment"

  /comments/{idPost}/{commentId}:
    get:
      tags:
        - Comments
      summary: Ver un comentario espec铆fico
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: idPost
          schema: { type: integer }
          required: true
        - in: path
          name: commentId
          schema: { type: integer }
          required: true
      responses:
        200:
          description: Detalle del comentario
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Comment"

    delete:
      tags:
        - Comments
      summary: Eliminar un comentario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: idPost
          schema: { type: integer }
          required: true
        - in: path
          name: commentId
          schema: { type: integer }
          required: true
      responses:
        200:
          description: Comentario eliminado

  /comments/{post}/crear:
    post:
      tags:
        - Comments
      summary: Crear comentario en un post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: post
          schema: { type: integer }
          required: true
          description: ID del Post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CommentInput"
      responses:
        201:
          description: Comentario creado

  /comments/{id}:
    patch:
      tags:
        - Comments
      summary: Editar comentario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CommentInput"
      responses:
        200:
          description: Comentario actualizado

  /comments/{user}/{id}/like:
    post:
      tags:
        - Comments
      summary: Dar like a comentario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user
          schema: { type: string }
          required: true
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        201:
          description: Like registrado
